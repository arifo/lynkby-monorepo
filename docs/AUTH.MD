end-to-end auth spec for the dashboard using Email OTP and Google Sign-In, with a cookie-based session (no JWT) and a rolling 30-day expiry that refreshes on each authorized request

â¸»

	â€¢	Auth methods: Email OTP + Google OAuth (no magic link).
	â€¢	Session cookie (httpOnly) with rolling 30 days (sliding window).
	â€¢	No JWTs anywhere.
	â€¢	Cross-app domain: cookie valid for app.lynkby.com and api.lynkby.com (sameSite=Lax).
	â€¢	Hardened security: CSRF protection, rate limiting, device/session management.

â¸»

ğŸ¯ Whatâ€™s changing
	â€¢	Mailer: Use Resend for all auth emails.
	â€¢	Auth UI: One column: Email input â†’ separator â†’ â€œContinue with Googleâ€.
	â€¢	OTP UX: After â€œSend codeâ€, show OTP input inline below the email.
While OTP is visible, the email field is disabled for typing, but thereâ€™s a â€œChange emailâ€ affordance that safely resets state.

Everything else from the prior auth spec (cookie session, rolling 30 days, CSRF, rate limits) stays the same.

â¸»

ğŸ”Œ Mail Delivery â€” Resend

Environment
	â€¢	RESEND_API_KEY (server only)
	â€¢	RESEND_FROM=login@lynkby.com (or no-reply@lynkby.com)
	â€¢	Optional brand: RESEND_REPLY_TO=support@lynkby.com

API call
	â€¢	Endpoint: https://api.resend.com/emails
	â€¢	Headers: Authorization: Bearer ${RESEND_API_KEY}, Content-Type: application/json
	â€¢	Body (example):

{
  "from": "Lynkby <login@lynkby.com>",
  "to": ["user@example.com"],
  "subject": "Your Lynkby code: 123456",
  "html": "<!doctype html>... (see template)",
  "text": "Your Lynkby code is 123456. It expires in 10 minutes.",
  "tags": [{"name":"purpose","value":"auth-otp"}]
}

Templates (keep fast, brand-light)
	â€¢	Subject: Your Lynkby code: {{ code }}
	â€¢	Text (fallback):

Your Lynkby sign-in code is: {{ code }}
It expires in 10 minutes. If you didnâ€™t request it, ignore this email.


	â€¢	HTML (compact, accessible, system fonts; no images/external CSS). Keep under ~10KB.

Delivery/Retry
	â€¢	Send once per request; do not auto-retry client-side.
	â€¢	If Resend 429/5xx: backoff and return a generic 200 with â€œIf that email exists, we sent a code.â€ (avoid enumeration). Log internally.

â¸»

ğŸ§± Backend endpoints (API Worker)

POST /v1/auth/otp/request
	â€¢	Body: { email, csrfToken }
	â€¢	Validates email, CSRF, rate limits (5/hour/email & IP; 20/day/email).
	â€¢	Generate 6-digit code (000000â€“999999), store sha256(code), expiresAt = now + 10m.
	â€¢	Send via Resend (above).
	â€¢	Response: always 200 { ok:true } (no enumeration).

POST /v1/auth/otp/verify
	â€¢	Body: { email, code, csrfToken }
	â€¢	Verify against most recent unconsumed OTP within 10m; increment attempts on miss (lock after 5 wrong tries).
	â€¢	On success:
	â€¢	Mark consumedAt.
	â€¢	getOrCreate User(email); set emailVerified=true.
	â€¢	Create Session; set cookie lb_sess (httpOnly, Secure, SameSite=Lax, Domain=.lynkby.com, Max-Age=30d).
	â€¢	Response: 200 { ok:true } or 400 { error:"INVALID_OR_EXPIRED" }.

POST /v1/auth/otp/resend
	â€¢	Body: { email, csrfToken }
	â€¢	Only allowed after an initial request and before verification; min interval 30s between sends per email.
	â€¢	Enforce same rate limits; create new OTP (invalidate previous).
	â€¢	Response: 200 { ok:true }.

(Other session endpoints unchanged.)

â¸»

ğŸ–¥ï¸ Auth UI (single column)

Layout (desktop & mobile)
	â€¢	Centered max-width 420px, 24px padding, generous spacing.
	â€¢	Order:
	1.	Logo (small)
	2.	Headline: â€œSign in to Lynkbyâ€
	3.	Email block
	â€¢	Email input
	â€¢	Send code button
	â€¢	(after request) OTP inputs appear below email
	â€¢	Helper: â€œDidnâ€™t get a code? Resend in 30sâ€
	4.	Separator (â€œorâ€ with hairline)
	5.	Sign in with Google button
	6.	Legal: â€œBy continuing you agree toâ€¦â€

Components (suggested)
	â€¢	EmailInput
	â€¢	PrimaryButton
	â€¢	OtpInput (6 cells, auto-advance, paste-to-fill)
	â€¢	InlineNotice (errors/info)
	â€¢	Separator
	â€¢	GoogleButton

Email â†’ OTP UX

States
	â€¢	idle â†’ requesting â†’ code_sent â†’ verifying â†’ success | error
	â€¢	Local UI store keeps: email, emailLocked, cooldownMs, otp, errors.

Behaviors
	â€¢	Idle
	â€¢	Email input enabled; â€œSend codeâ€ primary.
	â€¢	Press Enter submits request.
	â€¢	Requesting
	â€¢	Disable inputs; show small spinner in button.
	â€¢	Code Sent
	â€¢	Show OTP input below the email; email field becomes disabled (grayed out).
	â€¢	A small â€œChange emailâ€ text button appears right under the email (not in the field) â†’ on click:
	â€¢	Confirm: â€œChange email and cancel this code?â€
	â€¢	Yes â†’ clear OTP state, unlock email, focus email.
	â€¢	No â†’ keep current state.
	â€¢	Show cooldown text: â€œResend code in 30sâ€ â†’ becomes Resend button when 0.
	â€¢	OTP Input
	â€¢	6 boxes; type auto-advances; Backspace moves back; paste â€œ123456â€ fills all.
	â€¢	When 6 digits present â†’ auto-submit or enable â€œVerifyâ€ button.
	â€¢	Verifying
	â€¢	Lock OTP cells; spinner on Verify.
	â€¢	Error
	â€¢	Show friendly message inline above OTP:
	â€¢	Invalid: â€œThat code didnâ€™t work. Try again.â€ (shake animation optional)
	â€¢	Expired: â€œCode expired. Get a new one.â€ (focus â€œResendâ€)
	â€¢	Keep email locked; allow â€œChange emailâ€.

Buttons/labels (copy)
	â€¢	â€œSend codeâ€
	â€¢	â€œEnter the 6-digit codeâ€ (field label)
	â€¢	â€œVerify & continueâ€
	â€¢	â€œChange emailâ€
	â€¢	â€œResend codeâ€ (activates when cooldown ends)
	â€¢	Helper text (neutral): â€œWeâ€™ll email a one-time code to sign you in.â€

Accessibility
	â€¢	Email has autocomplete="email".
	â€¢	OTP inputs share a group label (role="group" aria-labelledby="otp-label").
	â€¢	Support single hidden input binding for paste if using 6 visible boxes.
	â€¢	Live region for errors (aria-live="polite").

Edge cases
	â€¢	Wrong email typed: â€œChange emailâ€ resets safely; no lingering OTP.
	â€¢	Multiple tabs: each tab can request codes; server rate limits handle abuse.
	â€¢	Paste with spaces/dashes: clean input to digits.

â¸»

ğŸ” State machine (pseudo-logic)

state idle {
  on SEND_CODE(email) -> requesting
}
state requesting {
  effect: call POST /auth/otp/request
  on SUCCESS -> code_sent { emailLocked=true; startCooldown(30s) }
  on FAILURE -> idle { showGenericSent() } // still 200; UI proceeds to code_sent for consistency? Prefer: proceed to code_sent only on client success. Keep 200 true â†’ show â€œCheck your emailâ€.
}
state code_sent {
  on CHANGE_EMAIL -> confirm -> idle { clearOtp(); emailLocked=false; focusEmail() }
  on RESEND when cooldown==0 -> requesting (same as SEND_CODE)
  on OTP_FILLED(6digits) -> verifying
}
state verifying {
  effect: POST /auth/otp/verify
  on SUCCESS -> success (redirect /dashboard/home)
  on INVALID -> code_sent { showError("That code didnâ€™t work.") ; clearOtp(); focusOtp() }
  on EXPIRED -> code_sent { showError("Code expired.") ; enableResend() }
}

UX tip: when /auth/otp/request returns, always move to code_sent (show OTP UI) and surface â€œCheck your emailâ€. This keeps flow predictable and avoids revealing deliverability problems.

â¸»

ğŸ§­ Google Sign-in (same screen)
	â€¢	Keep in the same column under a small â€œorâ€ separator.
	â€¢	Button copy: Continue with Google
	â€¢	On click: redirect to /v1/auth/google/start.
	â€¢	On callback success â†’ set session cookie â†’ redirect to /dashboard/home.

â¸»

ğŸ”’ CSRF & Cookies (recap)
	â€¢	Set lb_csrf (non-httpOnly) when serving /login.
	â€¢	Require X-CSRF-Token for /auth/otp/request, /auth/otp/verify, /auth/otp/resend.
	â€¢	Session cookie lb_sess issued on verify/callback; rolling 30-day updates on each authed request.

â¸»

ğŸ“Š Rate limits (server)
	â€¢	/auth/otp/request: 5/hour/email and 5/hour/IP, 20/day/email.
	â€¢	/auth/otp/resend: min 30s between sends; shares the same bucket.
	â€¢	/auth/otp/verify: max 5 wrong attempts per OTP, then require new OTP.

â¸»

ğŸ§ª Acceptance criteria
	â€¢	Email screen shows only one column with Email â†’ separator â†’ Google.
	â€¢	After â€œSend codeâ€, OTP input appears below email, email becomes disabled, and â€œChange emailâ€ is visible.
	â€¢	â€œChange emailâ€ smoothly resets OTP state and focuses email without reload flicker.
	â€¢	Resend is disabled for 30s, then enabled; requesting resend preserves disabled email & OTP view.
	â€¢	Paste â€œ123 456â€ into OTP fills correctly; entering 6 digits auto-submits (or enables verify).
	â€¢	Error states are inline, human (â€œdidnâ€™t workâ€, â€œexpiredâ€) and accessible.
	â€¢	Resend uses Resend API and respects rate limits.
	â€¢	Successful verify creates cookie session; redirect to /dashboard/home.
	â€¢	Google button works from the same page; callback sets cookie; redirect home.
	â€¢	All mutating requests carry valid CSRF; missing/invalid â†’ 403.
	â€¢	No user enumeration anywhere.

â¸»

ğŸ§© Suggested UI structure (React + Tailwind)

<div className="mx-auto w-full max-w-[420px] px-6 py-10">
  <Logo className="mx-auto mb-6" />
  <h1 className="text-2xl font-semibold text-center mb-6">Sign in to Lynkby</h1>

  {/* Email block */}
  <label className="block text-sm font-medium mb-2">Email</label>
  <input type="email" autoComplete="email" disabled={emailLocked} ... />
  <button className="btn-primary mt-3 w-full" onClick={sendCode} disabled={!isValidEmail || requesting}>Send code</button>

  {phase === 'code_sent' && (
    <>
      <div className="mt-2 text-xs text-muted-foreground">
        <button className="underline" onClick={onChangeEmail}>Change email</button>
      </div>
      <div className="mt-5">
        <div id="otp-label" className="text-sm font-medium mb-2">Enter the 6-digit code</div>
        <OtpInput aria-labelledby="otp-label" value={otp} onChange={setOtp} />
        {error && <div role="status" aria-live="polite" className="mt-2 text-sm text-red-600">{error}</div>}
        <div className="mt-3 text-sm">
          {cooldown > 0
            ? <span className="text-muted-foreground">Resend code in {cooldown}s</span>
            : <button className="underline" onClick={resend}>Resend code</button>}
        </div>
        <button className="btn-primary mt-4 w-full" disabled={!otpReady || verifying} onClick={verify}>Verify & continue</button>
      </div>
    </>
  )}

  {/* Separator */}
  <div className="my-8 flex items-center gap-3">
    <div className="h-px flex-1 bg-border" />
    <span className="text-xs text-muted-foreground uppercase tracking-wider">or</span>
    <div className="h-px flex-1 bg-border" />
  </div>

  {/* Google */}
  <button className="btn-outline w-full" onClick={googleStart}>
    <GoogleIcon className="mr-2" /> Continue with Google
  </button>

  <p className="mt-8 text-center text-xs text-muted-foreground">
    By continuing, you agree to our Terms and Privacy Policy.
  </p>
</div>


-------------------------

Brand style guide for Lynkbyâ€™s screen that feels professional, modern, and consistent with the TikTok-creator-first positioning. This will ensure the login flow looks trustworthy, premium, and fast.

â¸»

ğŸ¨ Lynkby Auth Screen Style Guide

1. Brand Core
	â€¢	Brand personality: clean, sharp, creator-friendly, not â€œstartup scrappy.â€ Feels like a serious tool but still approachable.
	â€¢	Tone: professional, minimal, with subtle energy (like TikTok native but calmer).
	â€¢	Goal: convey trust (for login/security) and speed (sign-in in under 1 min).

â¸»

2. Color Palette

Primary
	â€¢	Emerald Green #34D399
â†’ Accent color for success states (verified, code sent).
	â€¢	Deep Indigo #4F46E5
â†’ Main CTA (e.g. â€œSend codeâ€, â€œVerify & continueâ€).
Strong but not aggressive, feels premium.

Secondary
	â€¢	Warm Orange #F97316
â†’ Used sparingly for highlights (e.g. resend timer, warnings).

Backgrounds
	â€¢	Light mode: #FAFAFA (soft gray-white)
	â€¢	Dark mode: #0D0D0D (true black, TikTok-friendly)

Surfaces
	â€¢	Light: #FFFFFF (cards, inputs)
	â€¢	Dark: #1A1A1A

Text
	â€¢	Light: #111827 (titles), #6B7280 (muted)
	â€¢	Dark: #F9FAFB (titles), #9CA3AF (muted)

â¸»

3. Typography
	â€¢	Font family: Inter or Plus Jakarta Sans (system fallback: system-ui, -apple-system, Segoe UI, Roboto, Arial).
	â€¢	Weights:
	â€¢	Headings: SemiBold (600)
	â€¢	Body: Regular (400)
	â€¢	Buttons: Medium (500)
	â€¢	Sizes:
	â€¢	H1 (auth title): 24px / 32px
	â€¢	Label: 14px / 20px
	â€¢	Input text: 16px / 24px
	â€¢	Helper/error text: 13px / 18px

â¸»

4. Components

Inputs
	â€¢	Shape: Rounded 12px radius.
	â€¢	Border: 1px solid #E5E7EB (light) / #374151 (dark).
	â€¢	Focus: 2px glow in Indigo #4F46E5.
	â€¢	Disabled: background #F3F4F6 (light) / #111827 (dark).

OTP Boxes
	â€¢	Six boxes, equal width, spaced evenly.
	â€¢	Border changes from neutral â†’ indigo on focus.
	â€¢	Subtle animation when filled (scale 1.02 â†’ 1.0).

Buttons
	â€¢	Primary: Indigo background #4F46E5, white text, rounded-lg (12px).
Hover: darker indigo #4338CA.
Disabled: #9CA3AF.
	â€¢	Outline: 1px solid #E5E7EB, text #111827 (light) / #F9FAFB (dark).
Hover: #F3F4F6.

Separator
	â€¢	Thin neutral line with centered text â€œorâ€ (uppercase, 12px, muted gray).

â¸»

5. Layout
	â€¢	Centered container, max-width 420px.
	â€¢	Vertical spacing: 24â€“32px between major sections.
	â€¢	Generous white space, no clutter.
	â€¢	Always vertically centered on large screens, scrollable on small screens.

â¸»

6. States & Feedback
	â€¢	Success (e.g. OTP sent): inline message with green text/icon.
	â€¢	Error: red #DC2626 text below input; shake animation optional.
	â€¢	Loading: button shows spinner but preserves width.
	â€¢	Disabled email after code: input grayed out but readable, with â€œChange emailâ€ link directly below in muted gray with underline.

â¸»

7. Motion & Microinteractions
	â€¢	Inputs: smooth 150ms focus glow.
	â€¢	OTP: auto-advance animation (scale bounce).
	â€¢	Errors: fade-in + slight shake.
	â€¢	Separator: subtle fade when appearing after OTP step.
	â€¢	Confetti (tiny burst) only after successful login â†’ optional, not default.

â¸»

8. Dark Mode Adjustments
	â€¢	Background: #0D0D0D
	â€¢	Surface (inputs, cards): #1A1A1A
	â€¢	Text: White #F9FAFB and muted #9CA3AF
	â€¢	Borders: #2D2D2D
	â€¢	Indigo CTA: stays as-is (good on dark).
	â€¢	Errors: Red #F87171
	â€¢	Success: Emerald #34D399

â¸»

9. Example Composition

Light mode

[ Lynkby logo ]
Sign in to Lynkby

[ Email input                ]
[ Send code button            ]
(change email / resend under input)
[ OTP boxes appear after code ]

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ or â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

[ Continue with Google button ]

By continuing, you agree to our Terms & Privacy Policy.

Dark mode is identical but swaps background/surface/text colors.

â¸»

10. Branding Touches
	â€¢	Logo: minimal wordmark in black (light) or white (dark).
	â€¢	Subtle gradient accents in CTA buttons (Indigo â†’ Violet) for brand personality.
	â€¢	Footer link to lynkby.com with muted color (12px).

â¸»

ğŸ‘‰ This guide ensures your auth screen feels consistent, professional, and premium, while being smooth and user-friendly.
